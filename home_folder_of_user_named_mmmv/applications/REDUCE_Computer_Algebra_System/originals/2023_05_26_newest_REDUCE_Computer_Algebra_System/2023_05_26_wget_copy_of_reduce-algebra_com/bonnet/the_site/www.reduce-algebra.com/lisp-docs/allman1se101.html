<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Monitoring of Performance</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,html --> 
<meta name="src" content="allman1.tex"> 
<meta name="date" content="2014-05-02 18:10:00"> 
<link rel="stylesheet" type="text/css" href="allman1.css"> 
</head><body 
>
<p align="centre"><img src="http://www.reduce-algebra.com/lisp-docs/redlogo.png" width=621 height=60 border=0 alt="REDUCE"></p><table cellspacing="5"><tr><td class="clinks"><a 
href="allman1li25.html#allman1se101.html" >Up</a></td><td class="clinks"><a 
href="allman1se102.html" >Next</a></td><td class="clinks"><a 
href="allman1se100.html" >Prev</a></td><td class="clinks"><a 
href="allman1se100.html#tailallman1se100.html" >PrevTail</a></td><td class="clinks"><a 
href="allman1se101.html#tailallman1se101.html">Tail</a></td></tr></table><h3 class="sectionHead"><span class="titlemark">26.6    </span> <a 
 id="x129-25400026.6"></a>Monitoring of Performance</h3>
<!--l. 335--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">26.6.1    </span> <a 
 id="x129-25500026.6.1"></a>SPY (Unix only)</h4>
<!--l. 337--><p class="noindent" >The Unix profil system call provides a facility to get information about the cpu consumption in a
LISP program. A simple interface was build to be able to turn profiling on and off and to map
the results on to the LISP address space. For details, please refer to the source code in
<span class="verb"><span 
class="pcrr7t-x-x-120">$pxu/spy.sl</span>. <br 
class="newline" />
<!--l. 347--><p class="noindent" ><span 
class="pcrr7t-x-x-120">(spywhole N:Integer): void                              </span><span 
class="ptmri7t-x-x-120">expr</span>
      <ul class="itemize1">
      <li class="itemize">Turns on profiling for the whole bps space. N must be a power of 2, defining the
      grain for the profil call. Typical values are 4 and 8. Returns <span 
class="pcrr7t-x-x-120">nil</span>.</li></ul>
<!--l. 356--><p class="noindent" ><span 
class="pcrr7t-x-x-120">(spyprint): void                                        </span><span 
class="ptmri7t-x-x-120">expr</span>
      <ul class="itemize1">
      <li class="itemize">Turns  off  the  profiler.  Prints  profiler  information  after  mapping  it  to  the  LISP
      address  space,  i.e  the  names  of  LISP  functions  are  printed  together  with  their
      relative  cpu  consumption.  The  variable  &amp;spyminimum&amp;  defines  the  cutoff  for
      spyprint, i.e. functions with less than &amp;spyminimum&amp; ticks will not be printed.
      Returns <span 
class="pcrr7t-x-x-120">nil</span>.</li></ul>
<!--l. 366--><p class="noindent" ><span 
class="pcrr7t-x-x-120">(spyon fwa lwa tslice bucketsize power): void           </span><span 
class="ptmri7t-x-x-120">expr</span>
      <ul class="itemize1">
      <li class="itemize">This  is  a  complete  interface  for  the  profil  call.  Allocates  Warray  space  for  the
      Unix profiler and turns on profiling. fwa and lwa are the addresses of the first and
      last word of code memory which should be inspected, tslice is the timeslice and
      not  suported  on  most  Unix  systems.  It  is  a  parameter  for  compatibility  reasons.
      Bucketsize must be a power of 2 and power is the base 2 logarithm of bucketsize.
      Typical values are 4 or 8 for bucketsize and 2 or 3 for power resp. Returns <span 
class="pcrr7t-x-x-120">nil</span>.</li></ul>
<!--l. 369--><p class="noindent" ><span 
class="pcrr7t-x-x-120">(spyoff): void                                          </span><span 
class="ptmri7t-x-x-120">expr</span>
      <ul class="itemize1">
      <li class="itemize">Turns off profiling using the Unix profil system call. Returns <span 
class="pcrr7t-x-x-120">nil</span>.</li></ul>
<!--l. 371--><p class="noindent" >Example:

<div class="verbatim" id="verbatim-437">
(load&#x00A0;spy&#x00A0;zbig)
&#x00A0;<br />
&#x00A0;<br />NIL
&#x00A0;<br />
&#x00A0;<br />(spywhole&#x00A0;4)
&#x00A0;<br />
&#x00A0;<br />NIL
&#x00A0;<br />
&#x00A0;<br />(null&#x00A0;(setq&#x00A0;aa(expt&#x00A0;3000&#x00A0;10000)))
&#x00A0;<br />
&#x00A0;<br />NIL
&#x00A0;<br />
&#x00A0;<br />(spyprint)&#x00A0;&#x00A0;%&#x00A0;This&#x00A0;was&#x00A0;done&#x00A0;on&#x00A0;a&#x00A0;SUN4&#x00A0;PSL
&#x00A0;<br />
&#x00A0;<br />214&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;39.5%&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;BPLUSA2
&#x00A0;<br />204&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;37.7%&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;INITCODE
&#x00A0;<br />67&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;12.3%&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;WTIMESDOUBLE
&#x00A0;<br />15&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;2.7%&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;COPYFROMONESTATICHEAP
&#x00A0;<br />12&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;2.2%&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;XXCOPYFROMSTACK
&#x00A0;<br />12&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;2.2%&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;SET_HEAP_SIZE
&#x00A0;<br />NIL
</div>
<!--l. 394--><p class="nopar" >
<!--l. 396--><p class="noindent" >It is easy to see that the command <span class="verb"><span 
class="pcrr7t-x-x-120">(null</span><span 
class="pcrr7t-x-x-120">&#x00A0;(setq</span><span 
class="pcrr7t-x-x-120">&#x00A0;aa(expt</span><span 
class="pcrr7t-x-x-120">&#x00A0;3000</span><span 
class="pcrr7t-x-x-120">&#x00A0;10000))) </span>leads to a
lot of bignum computations. The spyprint output proves that. Please note that <span class="verb"><span 
class="pcrr7t-x-x-120">INITCODE </span>sums
up all the functions that belong to PSL&#8217;s C runtime support. In this case the high percentage is
due to the fact that the (old) SPARC implementation performs integer multiply and divide in
software i.e. in non LISP code.
<!--l. 403--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">26.6.2    </span> <a 
 id="x129-25600026.6.2"></a>Qualified timing</h4>
<!--l. 405--><p class="noindent" >Qualified counting is used to measure the cpu time spend between call and return from a
function, not necessarily spend within the body of the function. It gives an overview about the
costs that a call of particular function causes. The sum shown as result may be bigger that 100
percent, if a function and its callee are both measured or if gc time is accumulated.
<br 
class="newline" />
<!--l. 414--><p class="noindent" ><span 
class="pcrr7t-x-x-120">(qualtime S:list): void                                </span><span 
class="ptmri7t-x-x-120">macro</span>
      <ul class="itemize1">
      <li class="itemize">Starts qualified timing for the list of functions contained in list. Returns <span 
class="pcrr7t-x-x-120">nil</span>.</li></ul>
<!--l. 417--><p class="noindent" ><span 
class="pcrr7t-x-x-120">(print!-qualtime): void                                 </span><span 
class="ptmri7t-x-x-120">expr</span>

   <ul class="itemize1">
   <li class="itemize">Prints  the  accumulated  timings  and  number  of  calls  for  all  functions.  Resets
   counters. Returns <span 
class="pcrr7t-x-x-120">nil</span>.</li></ul>
<!--l. 419--><p class="noindent" >Example:

<div class="verbatim" id="verbatim-438">
(load&#x00A0;qualified-timing&#x00A0;zbig)
&#x00A0;<br />(off&#x00A0;usermode)
&#x00A0;<br />
&#x00A0;<br />(qualtime&#x00A0;gtpos&#x00A0;times2)
&#x00A0;<br />
&#x00A0;<br />&#x00A0;(null&#x00A0;(setq&#x00A0;aa(expt&#x00A0;3000&#x00A0;10000)))&#x00A0;%&#x00A0;this&#x00A0;will&#x00A0;be&#x00A0;measured
&#x00A0;<br />
&#x00A0;<br />(print-qualtime)
&#x00A0;<br />&#x00A0;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x00A0;Qualified&#x00A0;Timing&#x00A0;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;
&#x00A0;<br />&#x00A0;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x00A0;Overall&#x00A0;Cpu&#x00A0;time&#x00A0;:&#x00A0;&#x00A0;5083&#x00A0;&#x00A0;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x22C6;&#x22C6;&#x22C6;&#x00A0;TIMES2&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x22C6;&#x00A0;calls&#x00A0;:&#x00A0;18&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x22C6;&#x00A0;time&#x00A0;:&#x00A0;5797&#x00A0;&#x00A0;&#x22C6;&#x00A0;%&#x00A0;114
&#x00A0;<br />&#x00A0;&#x22C6;&#x22C6;&#x22C6;&#x00A0;GTPOS&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x22C6;&#x00A0;calls&#x00A0;:&#x00A0;5560&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x22C6;&#x00A0;time&#x00A0;:&#x00A0;935&#x00A0;&#x00A0;&#x00A0;&#x22C6;&#x00A0;%&#x00A0;18
&#x00A0;<br />
</div>
<!--l. 436--><p class="nopar" >
<!--l. 438--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">26.6.3    </span> <a 
 id="x129-25700026.6.3"></a>Qualified counting</h4>
<!--l. 440--><p class="noindent" >For our own applications it had turned out to be useful to know the callers of a function
especially when the function is called very, very often, e.g. basic routines like generic arithmetic.
To provide this a module qualified counting was generated using a similar syntax like qualified
timing. <br 
class="newline" />
<!--l. 448--><p class="noindent" ><span 
class="pcrr7t-x-x-120">(qualcount S:list): void                               </span><span 
class="ptmri7t-x-x-120">macro</span>
      <ul class="itemize1">
      <li class="itemize">Starts qualified counting for the list of functions contained in list. Returns <span 
class="pcrr7t-x-x-120">nil</span>.</li></ul>
<!--l. 454--><p class="noindent" ><span 
class="pcrr7t-x-x-120">(print!-qualcount): void                                </span><span 
class="ptmri7t-x-x-120">expr</span>
      <ul class="itemize1">
      <li class="itemize">Prints  the  accumulated  call  counting  and  the  callers  for  all  functions.  Resets
      counters. Printing will be suppressed if the number of calls is less than bordervalue
      (default = 20) Returns <span 
class="pcrr7t-x-x-120">nil</span>.</li></ul>
<!--l. 458--><p class="noindent" ><span 
class="pcrr7t-x-x-120">(reset!-qualcount): void                                </span><span 
class="ptmri7t-x-x-120">expr</span>
      <ul class="itemize1">
      <li class="itemize">Resets the accumulated call counting and the callers for all functions. Returns <span 
class="pcrr7t-x-x-120">nil</span>.</li></ul>
<!--l. 460--><p class="noindent" >Example:

<div class="verbatim" id="verbatim-439">
&#x00A0;(load&#x00A0;qualified-counting)
&#x00A0;<br />&#x00A0;(off&#x00A0;usermode)
&#x00A0;<br />
&#x00A0;<br />&#x00A0;(qualcount&#x00A0;faslin&#x00A0;intern)
&#x00A0;<br />&#x22C6;&#x22C6;&#x22C6;&#x00A0;Function&#x00A0;&#8216;G0003'&#x00A0;has&#x00A0;been&#x00A0;redefined
&#x00A0;<br />&#x22C6;&#x22C6;&#x22C6;&#x00A0;Function&#x00A0;&#8216;FASLIN'&#x00A0;has&#x00A0;been&#x00A0;redefined
&#x00A0;<br />&#x22C6;&#x22C6;&#x22C6;&#x00A0;Function&#x00A0;&#8216;G0025'&#x00A0;has&#x00A0;been&#x00A0;redefined
&#x00A0;<br />&#x22C6;&#x22C6;&#x22C6;&#x00A0;Function&#x00A0;&#8216;INTERN'&#x00A0;has&#x00A0;been&#x00A0;redefined
&#x00A0;<br />
&#x00A0;<br />&#x00A0;(load&#x00A0;nbig30)&#x00A0;%&#x00A0;this&#x00A0;will&#x00A0;be&#x00A0;counted
&#x00A0;<br />
&#x00A0;<br />(print-qualcount)
&#x00A0;<br />&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x00A0;calls&#x00A0;for&#x00A0;function&#x00A0;FASLIN&#x00A0;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;
&#x00A0;<br />
&#x00A0;<br />&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x00A0;calls&#x00A0;for&#x00A0;function&#x00A0;INTERN&#x00A0;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;&#x22C6;
&#x00A0;<br />
&#x00A0;<br />number&#x00A0;of&#x00A0;calls&#x00A0;:&#x00A0;306&#x00A0;from&#x00A0;READ-ID-TABLE
</div>
<!--l. 480--><p class="nopar" >

<!--l. 483--><p class="noindent" ><table cellspacing="5"><tr><td class="clinks"><a 
href="allman1li25.html#allman1se101.html" >Up</a></td><td class="clinks"><a 
href="allman1se102.html" >Next</a></td><td class="clinks"><a 
href="allman1se100.html" >Prev</a></td><td class="clinks"><a 
href="allman1se100.html#tailallman1se100.html" >PrevTail</a></td><td class="clinks"><a 
href="allman1se101.html" >Front</a></td></tr></table><a 
 id="tailallman1se101.html"></a>   
</body></html> 
