<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>The General Purpose Top Loop Function</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,html --> 
<meta name="src" content="allman1.tex"> 
<meta name="date" content="2014-05-02 18:10:00"> 
<link rel="stylesheet" type="text/css" href="allman1.css"> 
</head><body 
>
<p align="centre"><img src="https://reduce-algebra.sourceforge.io/lisp-docs/redlogo.png" width=621 height=60 border=0 alt="REDUCE"></p><table cellspacing="5"><tr><td class="clinks"><a 
href="allman1li10.html#allman1se47.html" >Up</a></td><td class="clinks"><a 
href="allman1se48.html" >Next</a></td><td class="clinks"><a 
href="allman1se46.html" >Prev</a></td><td class="clinks"><a 
href="allman1se46.html#tailallman1se46.html" >PrevTail</a></td><td class="clinks"><a 
href="allman1se47.html#tailallman1se47.html">Tail</a></td></tr></table><h3 class="sectionHead"><span class="titlemark">11.2    </span> <a 
 id="x60-14000011.2"></a>The General Purpose Top Loop Function</h3>
<!--l. 15--><p class="noindent" >The user interacts with PSL through toploop. The purpose of this loop is to read expressions
typed at the terminal, evaluate them, and type the result back on the terminal. Such expressions
may be entered to see what value they return or to produce a side-effect on the global
environment.
<!--l. 21--><p class="noindent" >An expression which has a side effect on the global environment

<div class="verbatim" id="verbatim-314">
&#x00A0;&#x00A0;(setq&#x00A0;base&#x00A0;10)
</div>
<!--l. 24--><p class="nopar" >Another example of a side effect, the definition of a function

<div class="verbatim" id="verbatim-315">
&#x00A0;&#x00A0;(de&#x00A0;square&#x00A0;(n)&#x00A0;(&#x22C6;&#x00A0;n&#x00A0;n))
</div>
<!--l. 28--><p class="nopar" >Evaluation, just to see what value the expression returns

<div class="verbatim" id="verbatim-316">
&#x00A0;&#x00A0;(square&#x00A0;2)
</div>
<!--l. 32--><p class="nopar" >A close approximation to the behavior of this loop is given by the following functional
description:

<div class="verbatim" id="verbatim-317">
(de&#x00A0;toploop&#x00A0;(toploopread&#x22C6;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;toploopeval&#x22C6;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;toploopprint&#x22C6;)
&#x00A0;<br />&#x00A0;&#x00A0;(while&#x00A0;t
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;(funcall&#x00A0;toploopprint&#x22C6;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;(funcall&#x00A0;toploppeval&#x22C6;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;(funcall&#x00A0;toploopread&#x22C6;)))))
</div>
<!--l. 44--><p class="nopar" >The actual toploop of PSL is somewhat more complex than the simple one defined here
because it provides a few extra features (these are described below). The important
point is that the primitives required for writing such a loop are all available to the
user.
<!--l. 51--><p class="noindent" >Syntactically correct expressions have a well defined mapping into PSL data structures, read
accomplishes this mapping. For example, linear list notation is converted into the internal tree
structure representation, strings are stored in a more efficient non-list form, and numbers are
internalized to a form compatible with the arithmetic unit of the machine. The most primitive
piece of read is the scanner. This routine recognizes characters special to PSL. For example,
space, (, and ). The scanner is also responsible for building the internal representation of
identifiers. The scanner must make every reference to a particular id point to the same internal
structure. This is accomplished at the time an id is created. The character sequence is compared
against sequences which have already been converted into ids. This comparison employs an
efficient search technique so that not every id is compared (currently a hash algorithm is
used).
<!--l. 68--><p class="noindent" >The eval function is responsible for the evaluation of data structures interpreted as programs. A
through discussion of this can be found in Chapter 11.
<!--l. 72--><p class="noindent" >Print displays data structures in a way which could later be typed back in to read. Some of the
more interesting print routines do prettyprinting. That is, they format the output using
conventions based on the structural nesting of the expressions.
<!--l. 78--><p class="noindent" >Giving the user the power to invoke all of these operation from his code is a very powerful
feature of LISP which sets it apart from most other languages.
<!--l. 95--><p class="noindent" ><div class="minipage"><a 
 id="dx60-140001"></a>
<span 
class="ptmb7t-x-x-120">(toploop </span><span 
class="ptmr7t-x-x-109">TOPLOOPREAD*:function TOPLOOPPRINT*:function</span><br 
class="newline" /><span 
class="ptmr7t-x-x-109">TOPLOOPEVAL*:function TOPLOOPNAME*:string WELCOMEBANNER:string)</span><span 
class="ptmb7t-x-x-120">: nil    </span><span 
class="ptmri7t-x-x-120">expr</span>
<br 
class="newline" /><div class="minipage">This  function  is  called  to  establish  a  new  Top  Loop.  It  prints  the
WELCOMEBANNER  and  then  invokes  a  Read-Eval-Print  loop,  using
the   functions   defined   by   TOPLOOPREAD*,   TOPLOOPEVAL*,   and
TOPLOOPPRINT*. Since each of the parameters to toploop is fluid they
may be examined or changed. Timing and history mechanisms are provided.
A prompt is constructed by prefixing TOPLOOPNAME* with the history
count. As a convention, the name is followed by a number of right angle
brackets (<span 
class="cmmi-12">&#x003E;</span>), to indicate the depth of toploop invocations.</div>
</div>

<!--l. 101--><p class="noindent" ><div class="minipage"><a 
 id="dx60-140002"></a>
<span 
class="ptmb7t-x-x-120">toploopread* </span>= [Initially: nil]                                                                                    <span 
class="ptmri7t-x-x-120">global</span>
<br 
class="newline" />&#x00A0;       &#x00A0;<div class="minipage">When toploop is called this id is bound to the function used for reading.
</div></div>
<!--l. 107--><p class="noindent" ><div class="minipage"><a 
 id="dx60-140003"></a>
<span 
class="ptmb7t-x-x-120">toploopeval* </span>= [Initially: nil]                                                                                    <span 
class="ptmri7t-x-x-120">global</span>
<br 
class="newline" />&#x00A0;       &#x00A0;<div class="minipage">When  toploop  is  called  this  id  is  bound  to  the  function  which  evaluates
input.</div>
</div>
<!--l. 113--><p class="noindent" ><div class="minipage"><a 
 id="dx60-140004"></a>
<span 
class="ptmb7t-x-x-120">toploopname* </span>= [Initially: string]                                                                             <span 
class="ptmri7t-x-x-120">global</span>
<br 
class="newline" />&#x00A0;       &#x00A0;<div class="minipage">Bound to a string (currently &#8221;lisp&#8221;), which will be part of the prompt for
input.</div>
</div>
<!--l. 118--><p class="noindent" ><div class="minipage"><a 
 id="dx60-140005"></a>
<span 
class="ptmb7t-x-x-120">toplooplevel* </span>= [Initially: 0]                                                                                      <span 
class="ptmri7t-x-x-120">global</span>
<br 
class="newline" />&#x00A0;       &#x00A0;<div class="minipage">Depth of top loop invocations.
</div></div>
<!--l. 126--><p class="noindent" ><div class="minipage"><a 
 id="dx60-140006"></a>
<span 
class="ptmb7t-x-x-120">initforms* </span>= [Initially: nil]                                                                                        <span 
class="ptmri7t-x-x-120">global</span>
<br 
class="newline" />&#x00A0;       &#x00A0;<div class="minipage">A  list  of  forms  to  be  evaluated  at  startup,  (prior  to  calling  main).  The
forms are evaluated in a left to right order, once the last form is evaluated
initforms* is set to nil.</div></div>
<!--l. 132--><p class="noindent" ><div class="minipage"><a 
 id="dx60-140007"></a>
<span 
class="ptmb7t-x-x-120">*output </span>= [Initially: T]                                                                                               <span 
class="ptmri7t-x-x-120">switch</span>
<br 
class="newline" />&#x00A0;       &#x00A0;<div class="minipage">If non-nil, the result of evaluating top level forms is printed.
</div></div>
<!--l. 138--><p class="noindent" ><div class="minipage"><a 
 id="dx60-140008"></a>
<span 
class="ptmb7t-x-x-120">*time </span>= [Initially: nil]                                                                                                 <span 
class="ptmri7t-x-x-120">switch</span>
<br 
class="newline" />&#x00A0;       &#x00A0;<div class="minipage">If  non-nil,  a  step  evaluation  time  is  printed  after  each  top  level  form  is
processed within toploop.</div>
</div>

<!--l. 155--><p class="noindent" ><div class="minipage"><a 
 id="dx60-140009"></a>
<span 
class="ptmb7t-x-x-120">(hist [N:integer]): nil                                                                                                  </span><span 
class="ptmri7t-x-x-120">nexpr</span>
<br 
class="newline" /><div class="minipage">Hist is called with 0, 1 or 2 integers, which control how much history is to
be printed out:
<div class="center" 
>
<!--l. 155--><p class="noindent" >
<div class="tabular"><table id="TBL-13" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-13-1g"><col 
id="TBL-13-1"><col 
id="TBL-13-2"></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-13-1-"><td  style="white-space:nowrap; text-align:left;" id="TBL-13-1-1"  
class="td11">(hist)      </td><td  style="white-space:nowrap; text-align:left;" id="TBL-13-1-2"  
class="td11">Display full history.                      </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-13-2-"><td  style="white-space:nowrap; text-align:left;" id="TBL-13-2-1"  
class="td11">(hist n m)</td><td  style="white-space:nowrap; text-align:left;" id="TBL-13-2-2"  
class="td11">Display history from n to m.        </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-13-3-"><td  style="white-space:nowrap; text-align:left;" id="TBL-13-3-1"  
class="td11">(hist n)    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-13-3-2"  
class="td11">Display history from n to present.</td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-13-4-"><td  style="white-space:nowrap; text-align:left;" id="TBL-13-4-1"  
class="td11">(hist -n)   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-13-4-2"  
class="td11">Display last n entries.                   </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-13-5-"><td  style="white-space:nowrap; text-align:left;" id="TBL-13-5-1"  
class="td11">      </td></tr></table></div></div></div></div>
<!--l. 157--><p class="noindent" >The following functions permit the user to access and resubmit previous expressions, and to
re-examine previous results.
<!--l. 163--><p class="noindent" ><div class="minipage"><a 
 id="dx60-140010"></a>
<span 
class="ptmb7t-x-x-120">(inp N:integer): any                                                                                                     </span><span 
class="ptmri7t-x-x-120">expr</span>
<br 
class="newline" /><div class="minipage">Return N&#8217;th input at this level.
</div></div>
<!--l. 167--><p class="noindent" ><div class="minipage"><a 
 id="dx60-140011"></a>
<span 
class="ptmb7t-x-x-120">(redo N:integer): any                                                                                                   </span><span 
class="ptmri7t-x-x-120">expr</span>
<br 
class="newline" /><div class="minipage">Reevaluate N&#8217;th input.
</div></div>
<!--l. 171--><p class="noindent" ><div class="minipage"><a 
 id="dx60-140012"></a>
<span 
class="ptmb7t-x-x-120">(ans N:integer): any                                                                                                     </span><span 
class="ptmri7t-x-x-120">expr</span>
<br 
class="newline" /><div class="minipage">Return N&#8217;th result.
</div></div>
<!--l. 176--><p class="noindent" ><div class="minipage"><a 
 id="dx60-140013"></a>
<span 
class="ptmb7t-x-x-120">historycount* </span>= [Initially: 0]                                                                                     <span 
class="ptmri7t-x-x-120">global</span>
<br 
class="newline" />&#x00A0;       &#x00A0;<div class="minipage">The number of entries which have been read so far.
</div></div>
<!--l. 184--><p class="noindent" ><div class="minipage"><a 
 id="dx60-140014"></a>
<span 
class="ptmb7t-x-x-120">historylist* </span>= [Initially: nil]                                                                                       <span 
class="ptmri7t-x-x-120">global</span>
<br 
class="newline" />&#x00A0;       &#x00A0;<div class="minipage">A list of pairs, the first element of each pair represents an input form, the
second is the result of evaluating the frst. Note that the top level evaluation
of historylist* will result in a circular list.</div>

</div>

<!--l. 186--><p class="noindent" ><table cellspacing="5"><tr><td class="clinks"><a 
href="allman1li10.html#allman1se47.html" >Up</a></td><td class="clinks"><a 
href="allman1se48.html" >Next</a></td><td class="clinks"><a 
href="allman1se46.html" >Prev</a></td><td class="clinks"><a 
href="allman1se46.html#tailallman1se46.html" >PrevTail</a></td><td class="clinks"><a 
href="allman1se47.html" >Front</a></td></tr></table><a 
 id="tailallman1se47.html"></a>  
</body></html> 
